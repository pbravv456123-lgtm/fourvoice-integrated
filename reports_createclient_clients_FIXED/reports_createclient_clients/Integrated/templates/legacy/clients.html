{% extends "legacy/base.html" %}

{% block page_title %}{% endblock %}
{% block page_subtitle %}{% endblock %}

{% block content %}
<div class="clients-page">
  <div class="clients-head">
    <div>
      <h1 class="clients-title">Clients</h1>
      <div class="clients-sub muted"><span id="clientsCount2">0</span> total clients</div>
    </div>

    <button class="btn primary clients-add" id="addClientBtn" type="button">
      <span class="btn-ic" aria-hidden="true">+</span>
      <span>Add Client</span>
    </button>
  </div>

  <div class="clients-search">
    <div class="searchbox">
      <span class="search-ic" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="18" height="18" class="ic">
          <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
          <path d="M20 20l-3.5-3.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </span>
      <input id="searchInput" type="text" placeholder="Search clients by name, company, or email..." autocomplete="off">
    </div>
  </div>

  <div class="grid" id="clientsGrid">
    <!-- cards injected by JS -->
  </div>
</div>

<!-- Add/Edit Client Modal -->
<div class="backdrop" id="clientModalBackdrop" hidden></div>
<div class="modal fv-modal fv-wide" id="clientModal" hidden aria-modal="false" role="dialog" aria-labelledby="clientModalTitle">
  <div class="fv-modal-head">
    <div>
      <div class="fv-modal-title" id="clientModalTitle">Add New Client</div>
      <div class="fv-modal-sub" id="clientModalSub">Enter complete client details</div>
    </div>
    <button class="fv-x" id="clientModalClose" aria-label="Close" type="button">âœ•</button>
  </div>

  <form class="fv-form" id="clientForm">
    <div class="fv-field">
      <label for="c_name">Client Name <span class="req">*</span></label>
      <input class="input" name="name" id="c_name" placeholder="Enter client name">
      <div class="err" data-err="name"></div>
    </div>

    <div class="fv-field">
      <label for="c_email">Email Address <span class="req">*</span></label>
      <input class="input" name="email" id="c_email" placeholder="client@example.com">
      <div class="err" data-err="email"></div>
    </div>

    <div class="fv-field">
      <label for="c_phone">Phone Number <span class="req">*</span></label>
      <input class="input" name="phone" id="c_phone" placeholder="+65 88776677">
      <div class="err" data-err="phone"></div>
    </div>

    <div class="fv-field">
      <label for="c_address">Address <span class="req">*</span></label>
      <textarea class="input" name="address" id="c_address" rows="4" placeholder="Enter client address"></textarea>
      <div class="err" data-err="address"></div>
    </div>

    <div class="fv-modal-actions">
      <button type="button" class="btn" id="clientModalCancel">Cancel</button>
      <button type="submit" class="btn primary" id="clientModalSave">Add Client</button>
    </div>
  </form>
</div>

<!-- Update confirm -->
<div class="backdrop" id="confirmBackdrop" hidden></div>
<div class="modal fv-modal fv-confirm" id="confirmModal" hidden aria-modal="false" role="dialog" aria-labelledby="confirmTitle">
  <button class="fv-x fv-confirm-x" id="confirmClose" aria-label="Close" type="button">âœ•</button>
  <div class="fv-confirm-body">
    <div class="fv-confirm-ic info" aria-hidden="true">i</div>
    <div>
      <div class="fv-confirm-title" id="confirmTitle">Update Client?</div>
      <div class="fv-confirm-text" id="confirmText">Are you sure you want to update this clientâ€™s information? This will apply to all future invoices.</div>
    </div>
  </div>
  <div class="fv-confirm-actions">
    <button class="btn" id="confirmCancel" type="button">Cancel</button>
    <button class="btn primary" id="confirmOk" type="button">Update Client</button>
  </div>
</div>

<!-- Delete confirm -->
<div class="backdrop" id="deleteBackdrop" hidden></div>
<div class="modal fv-modal fv-confirm" id="deleteModal" hidden aria-modal="false" role="dialog" aria-labelledby="deleteTitle">
  <button class="fv-x fv-confirm-x" id="deleteClose" aria-label="Close" type="button">âœ•</button>
  <div class="fv-confirm-body">
    <div class="fv-confirm-ic warn" aria-hidden="true">!</div>
    <div>
      <div class="fv-confirm-title" id="deleteTitle">Delete Client?</div>
      <div class="fv-confirm-text" id="deleteText">Are you sure you want to delete this client? This action cannot be undone and will affect all related invoices.</div>
    </div>
  </div>
  <div class="fv-confirm-actions">
    <button class="btn" id="deleteCancel" type="button">Keep Client</button>
    <button class="btn danger" id="deleteOk" type="button">Delete Client</button>
  </div>
</div>

<!-- Invoice history modal (kept) -->
<div class="backdrop" id="invBackdrop" hidden></div>
<div class="modal lg" id="invModal" hidden aria-modal="false" role="dialog" aria-labelledby="invTitle">
  <div class="modal-head">
    <div>
      <div class="modal-title" id="invTitle">Invoice history</div>
      <div class="muted small" id="invSub">â€”</div>
    </div>
    <button class="iconbtn" id="invClose" aria-label="Close">âœ•</button>
  </div>
  <div class="modal-body">
    <div class="stats-row" id="invStats"></div>
    <div class="toolbar slim">
      <div class="searchbox">
        <span class="search-ic">ðŸ”Ž</span>
        <input id="invSearch" type="text" placeholder="Search invoice number..." autocomplete="off">
      </div>
    </div>

    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr>
            <th>Invoice</th>
            <th>Issue date</th>
            <th class="right">Total</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="invTbody"></tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // scope-only tweaks for this page (does not touch navbar)
  document.body.classList.add("page-clients");
</script>
<script src="{{ url_for('static', filename='js/legacy/clients.js') }}"></script>
{% endblock %}
